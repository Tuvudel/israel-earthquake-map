<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Israel Earthquake Interactive Map</title>
    
    <!-- MapLibre GL JS -->
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    
    <!-- Manrope Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- noUiSlider for dual-range slider -->
    <link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.1/dist/nouislider.min.js"></script>
    
    <!-- Shoelace (CDN autoloader) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.0/cdn/themes/light.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.0/cdn/themes/dark.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.13.0/cdn/shoelace-autoloader.js"></script>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/components/features/magnitude-distribution.css">
    <!-- Theme initialization handled by js/ui/theme.js -->
</head>
<body>
    <div id="app">
        <!-- Header (title & main filters) -->
        <header id="filters-panel">
            <div class="container">
                <div class="header-layout">
                    <div class="title-section">
                        <h1>Israel Earthquakes</h1>
                    </div>
                    <div class="last-updated">
                        <span id="last-updated">
                            <svg class="icon" width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                                <path d="M12 7v5l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Updated: <sl-relative-time id="last-updated-time" numeric="auto">Loading...</sl-relative-time>
                        </span>
                        <div class="credits-container">
                            <span class="credits-trigger">Credits</span>
                            <div class="credits-popup">
                                <div>Earthquake Data: <a href="https://eq.gsi.gov.il/heb/earthquake/lastEarthquakes.php" target="_blank">Israel Geophysical Institute</a></div>
                                <div>Fault Lines: <a href="https://github.com/cossatot/gem-global-active-faults" target="_blank">GEM Global Active Faults</a></div>
                                <div>Tectonic Plates: <a href="https://data.humdata.org/dataset/tectonic-plate" target="_blank">HDX Tectonic Plates</a></div>
                                <div class="me-section">
                                    Me!:
                                    <a class="me-link" href="https://github.com/Tuvudel" target="_blank" rel="noopener">
                                        <img class="me-icon" src="assets/icons/github-mark.svg" alt="GitHub">
                                    </a>
                                    <a class="me-link" href="https://www.linkedin.com/in/tuval-udelsman-107929155/" target="_blank" rel="noopener">
                                        <img class="me-icon" src="assets/icons/linkedin-mark.svg" alt="LinkedIn">
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Unified Filters Pane (top-sheet): Magnitude / Country / Area + Date -->
                    <div id="filters-pane" class="filters-container" tabindex="-1" role="dialog" aria-label="Filters" aria-modal="false">
                        <!-- Magnitude Range (dual-range slider) -->
                        <div class="filter-group magnitude-group">
                            <label class="filter-label">Magnitude:</label>
                            <div class="year-slider-container" id="magnitude-range-container">
                                <div class="year-labels">
                                    <span id="mag-min-label">2.5</span>
                                    <span id="mag-max-label">8.0</span>
                                </div>
                                <div id="magnitude-range-slider"></div>
                            </div>
                        </div>

                        <!-- Country and Area Filters Container (stacked vertically) -->
                        <div class="filter-group location-filters-group">
                            <!-- Country Filter (Shoelace multiselect) -->
                            <div class="location-filter-item">
                                <label class="filter-label">Country:</label>
                                <sl-select id="country-multiselect" multiple placeholder="All Countries" clearable>
                                    <!-- Options populated by JS -->
                                </sl-select>
                            </div>

                            <!-- Area Filter (Shoelace multiselect) -->
                            <div class="location-filter-item">
                                <label class="filter-label">Area:</label>
                                <sl-select id="area-multiselect" multiple placeholder="All Areas" clearable>
                                    <!-- Options populated by JS -->
                                </sl-select>
                            </div>
                        </div>

                        <!-- Date Filter (Relative | Range) -->
                        <div class="filter-group year-group">
                            <div class="date-filter-card">
                                <!-- Mode Toggle + Summary -->
                                <div class="date-mode-row">
                                    <div class="date-mode-toggle" id="date-mode-toggle">
                                        <button type="button" class="toggle-btn active" data-mode="relative" id="date-mode-relative">
                                            <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                                <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                                                <path d="M12 7v5l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            <span>Recent</span>
                                        </button>
                                        <button type="button" class="toggle-btn" data-mode="range" id="date-mode-range">
                                            <svg class="icon" width="12" height="12" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                                <rect x="3" y="5" width="18" height="16" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
                                                <path d="M3 10h18" stroke="currentColor" stroke-width="2"/>
                                                <path d="M8 3v4M16 3v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                            </svg>
                                            <span>Historical</span>
                                        </button>
                                    </div>
                                    <div class="date-summary hidden" id="date-summary"></div>
                                </div>

                                <!-- Relative options -->
                                <div class="relative-options" id="relative-options">
                                    <button type="button" class="option-btn" data-value="1day">24 Hours</button>
                                    <button type="button" class="option-btn" data-value="7days">7 Days</button>
                                    <button type="button" class="option-btn active" data-value="30days" id="relative-30d">1 Month</button>
                                    <button type="button" class="option-btn" data-value="1year">1 Year</button>
                                </div>

                                <!-- Year Range (shown when mode = range) -->
                                <div class="year-slider-container hidden" id="year-range-container">
                                    <div class="year-labels">
                                        <span id="year-min-label">2020</span>
                                        <span id="year-max-label">2025</span>
                                    </div>
                                    <div id="year-range-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Header actions (top-right) -->
                    <div id="header-actions" class="header-actions">
                        <sl-button id="header-filters-toggle" variant="default" size="medium" aria-controls="filters-pane" aria-expanded="false" aria-label="Toggle filters">
                            <svg slot="prefix" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 4h18v2H3V4zm2 6h14v2H5v-2zm4 6h6v2H9v-2z"/>
                            </svg>
                            Filters
                        </sl-button>
                        <sl-button id="header-legend-toggle" variant="default" size="medium" aria-label="Toggle legend">
                            <svg slot="prefix" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Legend
                        </sl-button>
                        <sl-button id="header-data-toggle" variant="default" size="medium" aria-controls="sidebar" aria-expanded="true" aria-label="Toggle data panel">
                            <svg slot="prefix" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M3 3h18v18H3V3zm16 16V5H5v14h14zm-8-2h2v-4h-2v4zm0-6h2V9h-2v2z"/>
                            </svg>
                            Data
                        </sl-button>
                        <div class="basemap-toggle-row" title="Switch light/dark mode">
                            <sl-switch id="basemap-toggle" size="medium" aria-label="Switch light/dark mode"></sl-switch>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Mobile toggles (SVG icons for consistency with desktop design) -->
        <button id="mobile-legend-toggle" class="mobile-legend-toggle" aria-label="Toggle legend">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span class="toggle-text">Legend</span>
        </button>
        
        <button id="mobile-sidebar-toggle" class="mobile-sidebar-toggle" aria-label="Toggle data panel">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M3 3h18v18H3V3zm16 16V5H5v14h14zm-8-2h2v-4h-2v4zm0-6h2V9h-2v2z"/>
            </svg>
            <span class="toggle-text">Data</span>
        </button>
        
        <button id="mobile-filters-toggle" class="mobile-filters-toggle" aria-label="Toggle filters">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M3 4h18v2H3V4zm2 6h14v2H5v-2zm4 6h6v2H9v-2z"/>
            </svg>
            <span class="toggle-text">Filters</span>
        </button>

        <!-- Main content area -->
        <main id="main-content">
            <!-- Map container -->
            <div id="map-container">
                <div id="map"></div>
                
                <!-- Map Legend -->
                <div id="map-legend">
                    <div class="legend-header">
                        <h3>Legend</h3>
                        <button class="legend-toggle-btn" aria-label="Toggle legend view" aria-expanded="false">
                            <svg class="legend-toggle-icon" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Magnitude section - always visible -->
                    <div class="legend-section legend-section-magnitude">
                        <h4>Magnitude</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="legend-circle minor"></span>
                                <span>Minor (2.5-3.9)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-circle light"></span>
                                <span>Light (4.0-4.9)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-circle moderate"></span>
                                <span>Moderate (5.0-5.9)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-circle strong"></span>
                                <span>Strong (6.0-6.9)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-circle major"></span>
                                <span>Major (7.0+)</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional sections - hidden on mobile compact mode -->
                    <div class="legend-sections-expanded">
                        <div class="legend-section">
                            <h4>Size Scale (by Magnitude)</h4>
                            <div class="size-reference">
                                <span class="size-circle size-small"></span>
                                <span class="size-circle size-medium"></span>
                                <span class="size-circle size-large"></span>
                            </div>
                            <div class="size-labels">
                                <span>2.5-3.5</span>
                                <span>4.0-5.0</span>
                                <span>6.0+</span>
                            </div>
                        </div>
                        <div class="legend-section">
                            <h4>Geological Features</h4>
                            <div class="legend-items">
                                <div class="legend-item">
                                    <span class="legend-line solid"></span>
                                    <span>Fault Lines</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-line dotted"></span>
                                    <span>Tectonic Plates</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right sidebar with tabs -->
            <aside id="sidebar">
                <sl-tab-group placement="top" no-scroll-controls>
                    <sl-tab slot="nav" panel="events" active>Events</sl-tab>
                    <sl-tab slot="nav" panel="analytics">Analytics</sl-tab>

                    <!-- Events Tab Panel -->
                    <sl-tab-panel name="events">
                        <div id="data-table-panel">
                            <!-- Table Sort Controls -->
                            <div class="table-sort-controls">
                                <sl-button class="sortable" data-column="datetime" variant="default" size="small" aria-sort="none">
                                    Date/Time
                                    <svg slot="suffix" class="sort-indicator" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </sl-button>
                                <sl-button class="sortable" data-column="magnitude" variant="default" size="small" aria-sort="descending">
                                    Magnitude
                                    <svg slot="suffix" class="sort-indicator active desc" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </sl-button>
                                <sl-button class="sortable" data-column="depth" variant="default" size="small" aria-sort="none">
                                    Depth
                                    <svg slot="suffix" class="sort-indicator" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </sl-button>
                                <sl-button class="sortable" data-column="felt" variant="default" size="small" aria-sort="none">
                                    Felt?
                                    <svg slot="suffix" class="sort-indicator" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M7 10l5 5 5-5z"/>
                                    </svg>
                                </sl-button>
                            </div>
                            
                            <div class="table-container">
                                <table id="earthquake-table">
                                    <thead>
                                        <tr>
                                            <th scope="col">Date/Time (UTC)</th>
                                            <th scope="col">Magnitude</th>
                                            <th scope="col">Depth (km)</th>
                                            <th scope="col">Felt?</th>
                                        </tr>
                                    </thead>
                                    <tbody id="earthquake-table-body">
                                        <!-- Table rows will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <div id="pagination">
                                <div class="pagination-info">
                                    <span id="pagination-info-text" aria-live="polite">Showing 1-10 of 0 earthquakes</span>
                                </div>
                                <div class="pagination-controls">
                                    <sl-button id="prev-page" class="pagination-btn" size="small" disabled>Previous</sl-button>
                                    <div id="page-numbers"></div>
                                    <sl-button id="next-page" class="pagination-btn" size="small" disabled>Next</sl-button>
                                </div>
                            </div>
                        </div>
                    </sl-tab-panel>

                    <!-- Analytics Tab Panel -->
                    <sl-tab-panel name="analytics">
                        <div id="statistics-panel">
                            <div class="stat-grid">
                                <div class="stat-item stat-item-hover">
                                    <div class="stat-value" id="total-earthquakes">-</div>
                                    <div class="stat-label">Total Earthquakes</div>
                                </div>
                                <div class="stat-item stat-item-hover">
                                    <div class="stat-value" id="avg-magnitude">-</div>
                                    <div class="stat-label">Average Magnitude</div>
                                </div>
                                <div class="stat-item stat-item-hover">
                                    <div class="stat-value" id="avg-depth">-</div>
                                    <div class="stat-label">Average Depth (km)</div>
                                </div>
                                <div class="stat-item stat-item-hover">
                                    <div class="stat-value" id="land-water-percent">-</div>
                                    <div class="stat-label">On Land / Water</div>
                                </div>
                            </div>
                            
                            <!-- Magnitude Distribution Chart -->
                            <div id="magnitude-distribution-panel" class="magnitude-distribution">
                                <div class="distribution-header">
                                    <div class="distribution-title">Magnitude Distribution</div>
                                    <div class="distribution-subtitle" id="distribution-subtitle">Loading...</div>
                                </div>
                                <div class="distribution-chart">
                                    <div class="distribution-items" id="distribution-items">
                                        <!-- Will be populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </sl-tab-panel>
                </sl-tab-group>

            </aside>
        </main>

        <!-- Loading indicator -->
        <div id="loading" class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading earthquake data...</div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils/logger.js"></script>
    
    <!-- JavaScript modules: utils -> ui -> layers -> controllers -> ui (filters/statistics/table) -> main -->
    <script src="js/utils/constants.js"></script>
    <script src="js/utils/styleResolver.js"></script>
    <script src="js/core/eventBus.js"></script>
    
    <script src="js/services/persistService.js"></script>
    <script src="js/ui/theme.js"></script>
    <script src="js/ui/popup.js"></script>
    <script src="js/services/dataService.js"></script>
    <script src="js/services/filterService.js"></script>
    <script src="js/ui/toggles.js"></script>
    <script src="js/ui/animations.js"></script>
    <script src="js/ui/animationTest.js"></script>
    <script src="js/ui/mobileAnimations.js"></script>
    <script src="js/ui/filterAnimations.js"></script>
    <script src="js/ui/tabAnimations.js"></script>
    <script src="js/ui/header.js"></script>
    <script src="js/ui/responsive.js"></script>
    
    <script src="js/layers/earthquakeLayer.js"></script>
    <script src="js/layers/platesLayer.js"></script>
    
    <script src="js/controllers/interactions.js"></script>
    <script src="js/controllers/map.js"></script>
    
    <script src="js/ui/filters/utils/debounce.js"></script>
    <script src="js/ui/filters/utils/pips.js"></script>
    <script src="js/ui/filters/components/Slider.js"></script>
    <script src="js/ui/filters/components/MagnitudeSlider.js"></script>
    <script src="js/ui/filters/components/YearSlider.js"></script>
    <script src="js/ui/filters/components/DateMode.js"></script>

    <script src="js/ui/filters/index.js"></script>
    <script src="js/ui/statistics.js"></script>
    <script src="js/ui/table.js"></script>
    <script src="js/ui/legend.js"></script>
    
    <script src="js/main.js"></script>
</body>
</html>
