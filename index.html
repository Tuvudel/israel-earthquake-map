<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Israel Earthquake Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin=""/>
    
    <!-- Internal CSS -->
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #f8f9fa;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        select {
            padding: 0.25rem;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #map {
            flex: 1;
            height: 100%;
            background-color: #f5f5f5;
        }

        .info-panel {
            width: 300px;
            padding: 1rem;
            background-color: #f8f9fa;
            overflow-y: auto;
            border-left: 1px solid #ddd;
        }

        .info-panel h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.5rem;
        }

        #earthquake-details {
            margin-bottom: 1.5rem;
        }

        .statistics h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .statistics p {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        footer {
            padding: 0.5rem 1rem;
            background-color: #f8f9fa;
            text-align: center;
            font-size: 0.8rem;
            color: #666;
            border-top: 1px solid #ddd;
        }

        /* Styling for earthquake markers */
        .earthquake-marker {
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 10px;
            border: 1px solid rgba(0, 0, 0, 0.4);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }
            
            .info-panel {
                width: 100%;
                border-left: none;
                border-top: 1px solid #ddd;
            }
        }

        .legend {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            line-height: 1.5;
        }

        .legend-item {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border-radius: 50%;
            border: 1px solid #000;
        }
        
        #status-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 80%;
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>Israel Earthquake Map</h1>
        <div class="controls">
            <div class="filter-group">
                <label for="magnitude-filter">Minimum Magnitude:</label>
                <select id="magnitude-filter">
                    <option value="0">All</option>
                    <option value="2">2+</option>
                    <option value="3">3+</option>
                    <option value="4">4+</option>
                    <option value="5">5+</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="date-filter">Time Period:</label>
                <select id="date-filter">
                    <option value="all">All Time</option>
                    <option value="week">Last Week</option>
                    <option value="month">Last Month</option>
                </select>
            </div>
        </div>
    </header>
    
    <main>
        <!-- This div will hold our map -->
        <div id="map"></div>
        <div id="status-message"></div>
        
        <div class="info-panel">
            <h2>Earthquake Information</h2>
            <div id="earthquake-details">
                <p>Select an earthquake on the map to view details.</p>
            </div>
            <div class="statistics">
                <h3>Statistics</h3>
                <p>Total earthquakes: <span id="total-count">0</span></p>
                <p>Average magnitude: <span id="avg-magnitude">0</span></p>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Data source: Israel Geophysical Institute</p>
    </footer>

    <!-- Leaflet JavaScript - Loading before our application code -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
            crossorigin=""></script>
    
    <!-- Main application script -->
    <script>
        // Show a status message to the user
        function showStatus(message, isError = false) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.style.display = 'block';
            statusEl.style.backgroundColor = isError ? '#ffeeee' : 'white';
            statusEl.style.borderLeft = isError ? '4px solid red' : '4px solid #4682B4';
        }
        
        // Hide the status message
        function hideStatus() {
            document.getElementById('status-message').style.display = 'none';
        }
        
        // Your actual earthquake data from the CSV file
        const earthquakeCsvData = [
          {
            "epiid": "'202503061142'",
            "DateTime": "2025-03-06T11:42:27.549",
            "Mag": 3.9,
            "Lat": 28.948,
            "Long": 34.928,
            "Depth(Km)": 16.520182291667,
            "Region": "Saudi-Arabia",
            "Type": "F"
          },
          {
            "epiid": "'202503060354'",
            "DateTime": "2025-03-06T03:54:12.822",
            "Mag": 2.3,
            "Lat": 30.5371,
            "Long": 35.2932,
            "Depth(Km)": 18.2861328125,
            "Region": "Arava",
            "Type": "EQ"
          },
          {
            "epiid": "'202503060338'",
            "DateTime": "2025-03-06T03:38:50.691",
            "Mag": 2.6,
            "Lat": 30.5365,
            "Long": 35.3102,
            "Depth(Km)": 16.263834635417,
            "Region": "Arava",
            "Type": "EQ"
          },
          {
            "epiid": "'202503041217'",
            "DateTime": "2025-03-04T12:17:31.052",
            "Mag": 3,
            "Lat": 27.4213,
            "Long": 34.2391,
            "Depth(Km)": 28.255208333333,
            "Region": "Red-Sea",
            "Type": "EQ"
          },
          {
            "epiid": "'202503040557'",
            "DateTime": "2025-03-04T05:57:53.327",
            "Mag": 3.7,
            "Lat": 35.332,
            "Long": 26.1448,
            "Depth(Km)": 14,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202503031934'",
            "DateTime": "2025-03-03T19:34:37.434",
            "Mag": 2.4,
            "Lat": 33.9227,
            "Long": 34.7032,
            "Depth(Km)": 2.5065104166667,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202503031823'",
            "DateTime": "2025-03-03T18:23:34.531",
            "Mag": 2.3,
            "Lat": 28.889,
            "Long": 34.6688,
            "Depth(Km)": 0.79752604166667,
            "Region": "Aragonese-Deep",
            "Type": "EQ"
          },
          {
            "epiid": "'202503030601'",
            "DateTime": "2025-03-03T06:01:13.286",
            "Mag": 3.8,
            "Lat": 35.6513,
            "Long": 30.4827,
            "Depth(Km)": 35.091145833333,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202503021358'",
            "DateTime": "2025-03-02T13:58:54.939",
            "Mag": 2.2,
            "Lat": 33.9249,
            "Long": 34.749,
            "Depth(Km)": 10.292722702026,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202503021107'",
            "DateTime": "2025-03-02T11:07:48.778",
            "Mag": 3.2,
            "Lat": 34.7175,
            "Long": 33.2115,
            "Depth(Km)": 4.8506855964661,
            "Region": "Cyprus",
            "Type": "EQ"
          },
          {
            "epiid": "'202503010026'",
            "DateTime": "2025-03-01T00:26:28.188",
            "Mag": 4,
            "Lat": 34.1723,
            "Long": 26.9819,
            "Depth(Km)": 33.723958333333,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502282216'",
            "DateTime": "2025-02-28T22:16:44.626",
            "Mag": 2.9,
            "Lat": 34.9799,
            "Long": 36.759,
            "Depth(Km)": 29.622395833333,
            "Region": "Syria",
            "Type": "EQ"
          },
          {
            "epiid": "'202502280113'",
            "DateTime": "2025-02-28T01:13:25.924",
            "Mag": 2.5,
            "Lat": 28.6531,
            "Long": 34.5676,
            "Depth(Km)": 6.0384114583333,
            "Region": "Arnona-Dakar-Deep",
            "Type": "EQ"
          },
          {
            "epiid": "'202502270821'",
            "DateTime": "2025-02-27T08:21:59.417",
            "Mag": 3.1,
            "Lat": 31.6497,
            "Long": 35.6181,
            "Depth(Km)": 0.095833333333333,
            "Region": "Dead-Sea-Basin",
            "Type": "EQ"
          },
          {
            "epiid": "'202502270104'",
            "DateTime": "2025-02-27T01:04:41.450",
            "Mag": 2.7,
            "Lat": 36.0171,
            "Long": 35.7873,
            "Depth(Km)": 5,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502270005'",
            "DateTime": "2025-02-27T00:05:21.317",
            "Mag": 3,
            "Lat": 35.1749,
            "Long": 33.7018,
            "Depth(Km)": 27.571614583333,
            "Region": "Cyprus",
            "Type": "EQ"
          },
          {
            "epiid": "'202502262117'",
            "DateTime": "2025-02-26T21:17:06.700",
            "Mag": 3.8,
            "Lat": 36.1232,
            "Long": 31.5574,
            "Depth(Km)": 32.356770833333,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502252315'",
            "DateTime": "2025-02-25T23:15:33.487",
            "Mag": 2,
            "Lat": 30.6085,
            "Long": 35.3258,
            "Depth(Km)": 17.203776041667,
            "Region": "Arava",
            "Type": "EQ"
          },
          {
            "epiid": "'202502242146'",
            "DateTime": "2025-02-24T21:46:10.891",
            "Mag": 4.3,
            "Lat": 35.4517,
            "Long": 28.2156,
            "Depth(Km)": 32.356770833333,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502241133'",
            "DateTime": "2025-02-24T11:33:11.243",
            "Mag": 4.6,
            "Lat": 36.35,
            "Long": 26.031,
            "Depth(Km)": 75.651041666667,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502231628'",
            "DateTime": "2025-02-23T16:28:57.997",
            "Mag": 2.4,
            "Lat": 33.7095,
            "Long": 36.9994,
            "Depth(Km)": 2.2786458333333,
            "Region": "Palmira",
            "Type": "EQ"
          },
          {
            "epiid": "'202502210003'",
            "DateTime": "2025-02-21T00:03:22.402",
            "Mag": 3.4,
            "Lat": 34.7621,
            "Long": 32.5447,
            "Depth(Km)": 18.684895833333,
            "Region": "Cyprus",
            "Type": "EQ"
          },
          {
            "epiid": "'202502201730'",
            "DateTime": "2025-02-20T17:30:02.450",
            "Mag": 2.1,
            "Lat": 29.3598,
            "Long": 34.8266,
            "Depth(Km)": 12.923191070557,
            "Region": "Eilat-Deep",
            "Type": "EQ"
          },
          {
            "epiid": "'202502190251'",
            "DateTime": "2025-02-19T02:51:34.980",
            "Mag": 3.6,
            "Lat": 35.9054,
            "Long": 31.566,
            "Depth(Km)": 32.356770833333,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502181654'",
            "DateTime": "2025-02-18T16:54:43.425",
            "Mag": 5.3,
            "Lat": 37.0759,
            "Long": 21.619,
            "Depth(Km)": 19.140625,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502181058'",
            "DateTime": "2025-02-18T10:58:05.284",
            "Mag": 3.3,
            "Lat": 29.2361,
            "Long": 32.8392,
            "Depth(Km)": 0.91145833333333,
            "Region": "Suez",
            "Type": "EQ"
          },
          {
            "epiid": "'202502180608'",
            "DateTime": "2025-02-18T06:08:10.329",
            "Mag": 5,
            "Lat": 36.4641,
            "Long": 25.5899,
            "Depth(Km)": 14.188004493713,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502180446'",
            "DateTime": "2025-02-18T04:46:53.722",
            "Mag": 5.1,
            "Lat": 36.4283,
            "Long": 25.7751,
            "Depth(Km)": 17.232946395874,
            "Region": null,
            "Type": "EQ"
          },
          {
            "epiid": "'202502180354'",
            "DateTime": "2025-02-18T03:54:17.137",
            "Mag": 2.4,
            "Lat": 34.1541,
            "Long": 35.9243,
            "Depth(Km)": 111.19791666667,
            "Region": "Lebanon",
            "Type": "EQ"
          },
          {
            "epiid": "'202502180254'",
            "DateTime": "2025-02-18T02:54:09.387",
            "Mag": 4.5,
            "Lat": 36.5451,
            "Long": 25.8302,
            "Depth(Km)": 18.001302083333,
            "Region": null,
            "Type": "EQ"
          }
        ];

        /**
         * EarthquakeData class - Handles earthquake data processing
         */
        class EarthquakeData {
            constructor() {
                this.rawData = []; // Stores the original, unfiltered data
                this.filteredData = []; // Stores filtered data based on user selections
                this.isDataLoaded = false;
            }

            /**
             * Processes raw data after loading
             * @param {Array} data - Array of earthquake event objects
             */
            processRawData(data) {
                // Store the raw data
                this.rawData = data.map(item => {
                    // Ensure proper typing and format for all properties
                    return {
                        epiid: item.epiid ? item.epiid.replace(/^'|'$/g, '') : '', // Remove single quotes from IDs
                        dateTime: new Date(item.DateTime || ''),
                        magnitude: parseFloat(item.Mag) || 0,
                        latitude: parseFloat(item.Lat) || 0,
                        longitude: parseFloat(item.Long) || 0,
                        depth: parseFloat(item['Depth(Km)']) || 0,
                        region: item.Region || 'Unknown',
                        type: item.Type || 'Unknown'
                    };
                });

                // Initially, filtered data is the same as raw data
                this.filteredData = [...this.rawData];
                this.isDataLoaded = true;
            }

            /**
             * Applies filters to the earthquake data
             * @param {Object} filters - Filters to apply
             * @param {number} filters.minMagnitude - Minimum magnitude filter
             * @param {string} filters.timePeriod - Time period filter ('all', 'week', 'month')
             * @returns {Array} - Filtered earthquake data
             */
            applyFilters(filters = {}) {
                const { minMagnitude = 0, timePeriod = 'all' } = filters;
                
                // Start with all data
                let filtered = [...this.rawData];
                
                // Apply magnitude filter
                if (minMagnitude > 0) {
                    filtered = filtered.filter(quake => quake.magnitude >= minMagnitude);
                }
                
                // Apply time period filter
                if (timePeriod !== 'all') {
                    const now = new Date();
                    let cutoffDate;
                    
                    if (timePeriod === 'week') {
                        cutoffDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    } else if (timePeriod === 'month') {
                        cutoffDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    }
                    
                    if (cutoffDate) {
                        filtered = filtered.filter(quake => quake.dateTime >= cutoffDate);
                    }
                }
                
                this.filteredData = filtered;
                return this.filteredData;
            }

            /**
             * Gets statistics about the current filtered data
             * @returns {Object} - Statistics object
             */
            getStatistics() {
                const data = this.filteredData;
                const count = data.length;
                
                // Calculate average magnitude
                const totalMagnitude = data.reduce((sum, quake) => sum + quake.magnitude, 0);
                const avgMagnitude = count > 0 ? (totalMagnitude / count).toFixed(2) : 0;
                
                // Find max magnitude
                const maxMagnitude = count > 0 ? Math.max(...data.map(quake => quake.magnitude)) : 0;
                
                return {
                    count,
                    avgMagnitude,
                    maxMagnitude
                };
            }
        }

        // Create a single instance
        const earthquakeData = new EarthquakeData();

        // Main function to initialize the application
        function initApp() {
            try {
                showStatus("Loading earthquake data...");
                
                // Process the actual earthquake data
                earthquakeData.processRawData(earthquakeCsvData);
                
                showStatus("Initializing map...");
                
                // Check if Leaflet is loaded
                if (typeof L === 'undefined') {
                    throw new Error("Map library not loaded. Please check your internet connection and try again.");
                }
                
                // Initialize the map centered on the region
                const map = initializeMap();
                
                // Display earthquake markers
                displayEarthquakeMarkers(map, earthquakeData.filteredData);
                
                // Update statistics display
                updateStatistics();
                
                // Set up event listeners for filters
                setupFilterListeners(map);
                
                // Add a legend to the map
                addLegendToMap(map);
                
                // Hide status message
                hideStatus();
                
            } catch (error) {
                console.error("Application initialization error:", error);
                showStatus(`Error initializing application: ${error.message}. Please reload the page or try a different browser.`, true);
            }
        }

        /**
         * Initializes the Leaflet map centered on the region
         * @returns {Object} - Leaflet map instance
         */
        function initializeMap() {
            try {
                // Center coordinates based on actual earthquake data range
                const mapCenter = [32.25, 29.31];
                
                // Create map instance with initial view
                const map = L.map('map').setView(mapCenter, 7);
                
                // Add the base tile layer (OpenStreetMap)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(map);
                
                return map;
            } catch (error) {
                console.error("Map initialization error:", error);
                throw new Error("Failed to initialize map: " + error.message);
            }
        }

        /**
         * Displays earthquake markers on the map
         * @param {Object} map - Leaflet map instance
         * @param {Array} earthquakes - Array of earthquake data objects
         */
        function displayEarthquakeMarkers(map, earthquakes) {
            // Clear existing markers if any
            if (window.earthquakeMarkers) {
                window.earthquakeMarkers.clearLayers();
            }
            
            // Create a layer group for earthquake markers
            window.earthquakeMarkers = L.layerGroup().addTo(map);
            
            // Process each earthquake
            earthquakes.forEach(quake => {
                // Skip if coordinates are invalid
                if (!quake.latitude || !quake.longitude) return;
                
                // Determine marker size based on magnitude
                const markerSize = calculateMarkerSize(quake.magnitude);
                
                // Determine marker color based on depth
                const markerColor = calculateMarkerColor(quake.depth);
                
                // Create a circular marker
                const marker = L.circleMarker([quake.latitude, quake.longitude], {
                    radius: markerSize,
                    fillColor: markerColor,
                    color: '#000',
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                });
                
                // Add popup with information
                const popupContent = `
                    <strong>Magnitude:</strong> ${quake.magnitude}<br>
                    <strong>Date & Time:</strong> ${formatDateTime(quake.dateTime)}<br>
                    <strong>Depth:</strong> ${quake.depth} km<br>
                    <strong>Region:</strong> ${quake.region}<br>
                    <strong>Type:</strong> ${quake.type}
                `;
                marker.bindPopup(popupContent);
                
                // Add click event to display details in the info panel
                marker.on('click', () => {
                    displayEarthquakeDetails(quake);
                });
                
                // Add the marker to the layer group
                marker.addTo(window.earthquakeMarkers);
            });
        }

        /**
         * Adds a legend to the map explaining the marker colors and sizes
         * @param {Object} map - Leaflet map instance
         */
        function addLegendToMap(map) {
            const legend = L.control({ position: 'bottomright' });
            
            legend.onAdd = function() {
                const div = L.DomUtil.create('div', 'legend');
                
                div.innerHTML = `
                    <h4>Legend</h4>
                    <div><strong>Depth:</strong></div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFD700;"></div>
                        <span>< 5 km (Very Shallow)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFA500;"></div>
                        <span>5-10 km (Shallow)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF6347;"></div>
                        <span>10-20 km (Medium)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF0000;"></div>
                        <span>> 20 km (Deep)</span>
                    </div>
                    <div><strong>Size:</strong> Proportional to magnitude</div>
                `;
                
                return div;
            };
            
            legend.addTo(map);
        }

        /**
         * Calculates marker size based on earthquake magnitude
         * @param {number} magnitude - Earthquake magnitude
         * @returns {number} - Marker radius in pixels
         */
        function calculateMarkerSize(magnitude) {
            // Minimum size of 5, scales up with magnitude
            return Math.max(5, magnitude * 2);
        }

        /**
         * Calculates marker color based on earthquake depth
         * @param {number} depth - Earthquake depth in km
         * @returns {string} - Color in hex format
         */
        function calculateMarkerColor(depth) {
            // Color ranges from yellow (shallow) to red (deep)
            if (depth < 5) return '#FFD700'; // Yellow for very shallow
            if (depth < 10) return '#FFA500'; // Orange for shallow
            if (depth < 20) return '#FF6347'; // Tomato for medium
            return '#FF0000'; // Red for deep
        }

        /**
         * Formats a date object to a readable string
         * @param {Date} dateObj - Date object
         * @returns {string} - Formatted date string
         */
        function formatDateTime(dateObj) {
            if (!(dateObj instanceof Date) || isNaN(dateObj)) {
                return 'Unknown';
            }
            
            return dateObj.toLocaleString();
        }

        /**
         * Displays earthquake details in the info panel
         * @param {Object} quake - Earthquake data object
         */
        function displayEarthquakeDetails(quake) {
            const detailsElement = document.getElementById('earthquake-details');
            
            detailsElement.innerHTML = `
                <div class="detail-item">
                    <strong>Magnitude:</strong> ${quake.magnitude}
                </div>
                <div class="detail-item">
                    <strong>Date & Time:</strong> ${formatDateTime(quake.dateTime)}
                </div>
                <div class="detail-item">
                    <strong>Coordinates:</strong> ${quake.latitude.toFixed(4)}, ${quake.longitude.toFixed(4)}
                </div>
                <div class="detail-item">
                    <strong>Depth:</strong> ${quake.depth} km
                </div>
                <div class="detail-item">
                    <strong>Region:</strong> ${quake.region || 'Unknown'}
                </div>
                <div class="detail-item">
                    <strong>Event Type:</strong> ${quake.type}
                </div>
                <div class="detail-item">
                    <strong>Event ID:</strong> ${quake.epiid}
                </div>
            `;
        }

        /**
         * Updates the statistics display
         */
        function updateStatistics() {
            const stats = earthquakeData.getStatistics();
            
            document.getElementById('total-count').textContent = stats.count;
            document.getElementById('avg-magnitude').textContent = stats.avgMagnitude;
        }

        /**
         * Sets up event listeners for filter controls
         * @param {Object} map - Leaflet map instance
         */
        function setupFilterListeners(map) {
            const magnitudeFilter = document.getElementById('magnitude-filter');
            const dateFilter = document.getElementById('date-filter');
            
            // Function to apply all current filters
            const applyFilters = () => {
                const filters = {
                    minMagnitude: parseFloat(magnitudeFilter.value),
                    timePeriod: dateFilter.value
                };
                
                // Apply filters and get filtered data
                const filteredData = earthquakeData.applyFilters(filters);
                
                // Update map markers
                displayEarthquakeMarkers(map, filteredData);
                
                // Update statistics
                updateStatistics();
            };
            
            // Add event listeners
            magnitudeFilter.addEventListener('change', applyFilters);
            dateFilter.addEventListener('change', applyFilters);
        }
        
        // Start the application when the page is fully loaded
        window.addEventListener('load', initApp);
    </script>
</body>
</html>